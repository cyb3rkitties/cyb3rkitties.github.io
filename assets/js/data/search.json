[ { "title": "ExeWho2 - A Tool from the Wild", "url": "/posts/exewho2-download-execution-payload-red-teaming/", "categories": "research", "tags": "threat hunting, red teaming, malicious tool", "date": "2023-12-04 18:47:00 +0000", "snippet": "ExeWho2 appears to be a red teaming command line tool that can be used to deliver and execute obfuscated payloads on compromised systems. It’s written in Rust and it appears to be an evolution of Exe_who.The tool and its source code were found in the wild while performing threat hunting and analysis on open directories via the Censys database, along with a parser script written in Python that can be used to prepare the payload for execution via ExeWho2. Moreover, a UPX-packed sample containing string references to ExeWho2 was found on VirusTotal (big thanks to Maxime Thiebaut for this info).ExeWho2 Modules and FunctionalityExeWho2 is comprised of a main module, along with four other files: CLI, detectors, fetch, and patcher, which give a good idea of the functionalities of the tool.Payload PreparationBefore using the tool, a payload has to be prepared, which can be done using the Python script parser.py:The script optionally xors the payload with a key determined by user input, then appends a PNG header to the encrypted binary for further obfuscation.After that, the payload can be uploaded onto one or more servers. A json file containing the URL(s) has to be created and subsequently fed to ExeWho2 via the command line.Usage and Features (main.rs and fetch.rs)ExeWho2 takes one mandatory argument: the URL of the json file containing the list of servers where the binary is located.The tool also offers a –help menu that explains usage and arguments.Once launched with a valid URL, the tool will fetch the json file, parse it, and fetch the payload(s) from the server(s).To reveal download capabilities, I simulated the network connection by using a separate VM and python http server.The README file found with the source code also describes the error exit codes that the tool has the ability to throw.Decryption of the PayloadIf the payload was encrypted during preparation using parser.py, ExeWho2 offers the –key option to decrypt the binary after download and before execution.Execution of the PayloadTo execute the decrypted payload, ExeWho2 uses Memexec, a tool for loading and executing binaries from memory.Detection of Sandbox Environment (detectors.rs)Whenever the sandbox detection option is selected (–ds), the tool checks for the presence of files indicating that execution is happening in a virtual environment.Disabling ETW and AMSI (patchers.rs)ETW is the event tracing functionality on Windows systems that, in normal conditions, records events raised by user-mode applications and kernel-mode drivers. ExeWho2 has the capability to disable event tracing and does so by loading ntdll.dll via LoadLibrary, finding EtwEventWrite via GetProcAddress, changing memory permissions of the EtwEventWrite region with VirtualProtect, and subsequently overwriting one byte.AMSI is the Windows Antimalware Scan Interface, which normally provides anti-malware protection by acting as an interface between applications and anti-malware products. ExeWho2 disables AMSI by using a similar API call sequence as the one used to disable ETW: it starts by loading amsi.dll, then gets the address of AmsiScanBuffer, changes memory protection of the related region, and overwrites six bytes of the function.The full source code, which I found along with a number of payloads, is available in this Github repository.Hunting ExeWho2: Sigma ruleTo facilitate hunting and detection for this new tool, I wrote a Sigma rule which is also available in the related Github Repository.title: ExeWho2 Useid: ea36c9f1-6aca-4668-8e50-5e4955ec42f3status: experimentaldescription: Detects the usage of ExeWho2 CLI toolreferences: - https://cyb3rkitties.github.io/exewho2-download-execution-payload-red-teaming - https://github.com/cyb3rkitties/exewho2author: al3x perotti (cyb3rkitties)date: 2023/12/04tags: - attack.execution - attack.defense_evasion - attack.command_and_control - attack.t1059 - attack.t1071 - attack.t1105 - attack.t1027logsource: category: process_creation product: windowsdetection: selection: - Image|endswith: - '\\exewho2.exe' - CommandLine|contains: - ' -u http://*.json ' - ' -u *.json* ' condition: selectionlevel: high" }, { "title": "Malware Analysis & Investigation Framework", "url": "/posts/malware-analysis-investigation-framework/", "categories": "projects", "tags": "malware analysis, reverse engineering, MITRE ATT&CK", "date": "2023-10-03 14:31:00 +0000", "snippet": "If you started your malware analysis journey fairly recently, you have probably wondered a few times: where do I start from? What do I prioritize? That’s exactly what happened to me: at times, the amount of information collected can be overwhelming and this can make it tricky to focus on a single aspect of the findings.And that’s why I came up with the idea of this Malware Analysis &amp; Investigation Framework: I needed to organize my malware reverse engineering work in a flow that could be fairly repeatable, following a reference that could guide me through different steps in the reverse engineering process as well as helping me fight the habit of jumping from one tactic to the other without really getting to the bottom of it.This framework is modeled after MITRE ATT&amp;CK and is meant to be used in a proactive way to focus on one tactic at a time. After collecting information through static properties and behavioral analysis, the analyst can start reverse engineering by examining how the sample gets executed. They would be able to look at the example APIs included under the “Execution” tactic of the framework, make a note of the “keywords” these functions leverage, and compare them with patterns they see in the sample. After that, the analyst could move on by looking at persistence mechanisms, and so on.Even though the framework is presented similarly to MITRE ATT&amp;CK, it isn’t necessarily meant to be used in a linear fashion: a sample might require the analyst to prioritize certain tactics over others. For example, malware samples that include anti-analysis mechanisms might require the analyst to prioritize those over persistence.Beyond the analysis phase, the framework can also be useful as a guide to draft reports and technical presentations.It’s also important to state that this project wouldn’t have been possible without crucial community contributions such as Malapi.io and The Unprotect Project.This is obviously a draft, a first attempt and a work in progress that I plan to keep updated as much as possible. Please, send feedback to cyb3rkitties@proton.me or shoot me a message on LinkedIn." }, { "title": "Horabot - Malicious Infrastructure Investigation", "url": "/posts/horabot-malicious-infrastructure-investigation/", "categories": "research", "tags": "malware analysis, threat hunting, osint, malicious infrastructure", "date": "2023-07-01 12:25:00 +0000", "snippet": "After brainstorming for quite a while and getting incredibly excited for obtaining research access to Censys.io Search, I saw a very interesting report from the great folks at Cisco Talos on a new phishing campaign they track as Horabot and decided it was time to dig into an investigation and get lost in the many rabbit holes of threat hunting.My starting points were the Indicators of Compromise (IOCs) shared by the Talos team:IP addresses 139[.]177[.]193[.]74 185[.]45[.]195[.]226 216[.]238[.]70[.]224 51[.]38[.]235[.]152 137[.]220[.]53[.]87 212[.]46[.]38[.]43 191[.]101[.]2[.]101Domains tributaria[.]website facturacionmarzo[.]cloud m9b4s2[.]site wiqp[.]xyz ckws[.]info amarte[.]storeI decided to start from the last domain name, amarte[.]store and look it up on URLScan.io. The search revealed the IP address associated with the domain, 89[.]117[.]37[.]61, as well as a script at a very specific URL:I used the IP address for a Censys search, which confirmed the relationship and revealed the new domain maio23[.]com among the DNS names that link back to 89[.]117[.]37[.]61:Looking at the “Explore” tab on Censys, I could see all the relationships between this IP address, domains, and certificates:The SHA256 of the TLS certificate associated with port 443 is also common between amarte[.]storeand maio23[.]com:Even though it looks like we got to a dead end, I went back to URLScan and looked up the IP address directly, finding something quite curious:Looking at the URL history and HTTP transactions of this URL, another domain pops up: facturaion[.]sbs:Moreover, if we look at the screenshot that was taken at the time of the scan, we’ll see that it’s consistent with the campaign content, and includes an invite to download what Talos reported as a malicious RAR file:With a new domain in hand, we pivot back to Censys and find the Ip associated with this domain as well as another domain name f14.world and an IP associated with it: 154[.]49[.]243[.]254, connected through common certificate hashes:Focusing on the new IP, which shows the same services of the others (ports 22, 80, and 443), we can confirm the connection between the two domains as well as acquire some extra information.Please, note that this screenshot is taken from my notes: unfortunately, going back to Censys for more, I found out that-surprise surprise-services on this last IP were recently taken down:This is by no means the end of the research, though. To this point, we only pivoted using IP addresses and domain names, but we have so much information to dig through and use for further research. This includes JARM fingerprints, patterns derived from certificate information, and so much more.Until next time!" }, { "title": "Malware Analysis and Reverse Engineering Study Plan for Beginners", "url": "/posts/malware-analysis-reverse-engineering-beginner-study-plan/", "categories": "training", "tags": "malware analysis, reverse engineering, study plan", "date": "2023-01-03 09:39:00 +0000", "snippet": "As more people have been asking me for beginner-level malware analysis and reverse engineering training material, I decided to put together this short study plan with free and affordable resources to get you started on analyzing (mostly) Windows executables, with some references here and there to Linux as well.A word of caution before digging in: DO NOT WASTE YOUR TIME ON UDEMY. I took my fair share of classes on there and everything I checked out on malware, imho, is hot garbage that only made me really frustrated. I found very little useful information (compared to other, way more solid sources) and a ton of fillers, not to mention the general low quality of the material.Practical Malware Analysis &amp; Triage (PMAT) by HuskyHacks (Matt Kiely)Good for total beginners: it will walk you through every step of the malware analysis process and explain everything without making any assumptions on prior knowledge. If you are curious to learn more about malware analysis but aren’t sure whether this is your cup of tea yet, this is the right way to start: your tried and true 101 path.Practical Malware AnalysisThe Hands-On Guide to Dissecting Malicious Software, by Michael Sikorski, Andrew HonigThis book with downloadable exercises is the classic go-to for malware analysis beginners and is perfect for solidifying your knowledge and digging deeper after having had a first introduction. It’s very extensive and starts from the basics to later get to intermediate/advanced topics such as unpacking, anti-debugging, and anti-disassembly techniques.Reverse Engineering Tutorial by Kevin ThomasWhen I first became interested in reverse engineering, I asked a friend who’s been in infosec way longer than me for learning resources, and this is where he pointed me (thank you, Jesse!)If you’re close to knowing nothing about how compiled programs are made and how they run, the x86 Assembly Course is your best bet to get started. Then, you can upgrade to x64 and even ARM assembly.As a side note, these tutorials aren’t about malicious software, but are absolutely essential to better understand the inner workings of programs and learn the basics of Assembly.Assembly and Reverse Engineering classes on Open Security Training by Xeno KovahI found this amazing platform as I was looking for malware analysis and RE interview material: I stumbled upon the Life Of Binaries series, which is an (OLD BUT GOLD) in-depth explanation of the structure of Windows and Linux executables.The classes on OST are less geared towards malware analysis and more towards general reverse engineering: there’s everything from x86-64 Assembly to debugging, to software vulnerabilities, broken down and explained in the easiest possible way. There are many videos in which Xeno explains line by line what happens on the stack and in registers as each Assembly instruction is executed. Moral of the story: if you don’t have a computer science/IT background and are truly starting from zero when it comes to low-level code, you HAVE TO check this platform out and take at least the x86-64 class.Ultimate Malware Reverse Engineering Bundle by Zero 2 AutomatedI recently purchased this training (about $250) that includes both a “beginner” part and an advanced one, so I can’t speak about the whole class yet. What I can definitely say is that it goes very in-depth and exposes you to a varied number of samples and techniques.If you’re a real beginner like me, though, I don’t recommend starting from here: some of the “beginner” material isn’t really on a 101 level the same way some of the previous resources are. Of course, if you have already taken some of the classes I previously mentioned, there’s a chance that you’ll rapidly scroll through some of the videos in this one, such as lab setup and basic Assembly. Although, you’ll find other sections incredibly valuable and foundational, such as the overviews on how encryption and hashing algorithms implemented in malware, which I haven’t found in any of the previous training material.I hope you’ll find this material valuable. Feel free to hit me up on LinkedIn with any questions." }, { "title": "How to survive the SANS Women's Immersion Academy on top of a full-time job (and have a lot of fun while doing it)", "url": "/posts/survive-thrive-sans-womens-immersion-academy-full-time-job/", "categories": "training", "tags": "women's immersion academy, sans, gsec, gcih, grem", "date": "2023-01-03 09:39:00 +0000", "snippet": "On December 31st, I took the certification exam for my last course in the SANS Women’s Immersion Academy and closed this amazing 6-month-long experience with a 99% score on the GREM test.As a beginner in information security, and as someone with a full-time job and various other commitments, preparing three GIAC certification in roughly six months was certainly a challenge. But, if you’re considering taking this path, you should know that, if you have enough passion and drive, YOU WILL SUCCEED.When it comes to the specific courses, a lot will depend on your skills, curiosities, and aptitude. Some topics might feel easier to you, whereas you might need to spend more time on others. Regardless, here’s some advice I would give to anyone starting their Academy journey.Plan. And stick to your plan.If you’re taking the classes on top of a full-time job, planning is going to be essential. I calculated the amount of hours that would take me to go watch the videos, read the books, and complete the labs. Then, I put aside 20-25 hours a week to study — two hours a day on weekdays, five to six a day over the weekend — and split up the material. This way, I had no gray areas: I already knew what I would do each day and would (mostly) be able to avoid procrastinating or giving myself undeserved “passes.”On top of watching the videos and reading the books, you might want to allocate time to taking notes and indexing, which will impact your study time at different levels. So, try to build in some flexibility and add extra hours to make up for that.The second (and equally important) part of that is sticking to the plans you made. Having everything in a spreadsheet (or on paper) definitely helps avoid going off track. But we are human and, at times, fatigue kicks in: cut yourself some slack if you feel like you really need it, but don’t fall too far behind. Try to find a balance, even if it’s tricky: I swear it will be worth it and you will be very proud of yourself.Since I am no genius, pulling off these certifications meant putting on pause my whole life outside of work and study for six months. Sure, I missed a lot of people and things I love to do, but it was all worth it.Everyone does it differently.There are people who like to watch videos and listen to mp3s. Others who would rather read the books a number of times. Other people like to take notes on everything. Others who prefer to index while they are going through the material.The moral of the story is that everyone has their own preferences and absorbs information in different ways, so what worked for me might not work for you. Keeping that in mind, for each exam I did: A first pass where I watched the videos and read the corresponding part of the books, highlighting the most relevant concepts and marking them for indexing. A second pass where I only read the books, and marked more terms for indexing. This is because the GIAC exams are 100% focused on the books. A “third pass” where I just indexed the terms from the books. Each lab at least twice. Before taking the first practice test, I’ve always completed all of the above. After that, and based on my score, I reviewed specific sections and labs, at times adjusting the index, at times just going through the pages and reading the slide content to reinforce my knowledge.SEC401 and GSECOne word: index, index, index. As many people say, this course is an inch deep and a mile wide. There are so many topics and specifics that it’s almost impossible to memorize everything within the time frame you’re given. So, for this course and exam, indexing well and in-depth is key, and making multiple passes for indexing purposes is essential. The practice tests will be a great proving ground for your index and to understand how fast you can look things up.SEC504 and GCIHIf I had to pick one word for this course/exam, it would be cheat sheets. In this class, there are a collection of tools you will have to learn, each of them with lots of options and flags. The best way to summarize that, at least for me, was to make custom cheat sheets with all the contents of books and workbooks. This spared me a lot of time during the exam, as I didn’t have to search through the books and had my quick reference handy.I built an index as well, but it was way shorter than the GSEC one and I didn’t use it as much.Should you have any questions on the SANS Women’s Immersion Academy, feel free to connect with me on Linkedin and ask away!" }, { "title": "SANS Women's Immersion Academy - Two weeks in", "url": "/posts/sans-womens-immersion-academy-two-weeks/", "categories": "training", "tags": "women's immersion academy, sans, gsec, sec401", "date": "2022-07-03 12:58:00 +0000", "snippet": "The SANS Women’s Immersion Academy kicked off on June 21st with an introductory call and, since then, I’ve been in study-study-study mode, as I prepare for the GSEC exam and go through SEC401 study material.After completing the enrollment process, which took less than a day, I received access to the online material, which includes: SANS OnDemand: Audio and slides of all the material, quizzes, and book content. Labs material: Virtual machines and related instructions. Downloadable material: PDFs of the books, the workbook, and MP3 files of the classes. Access to the SANS App, which is a mobile version of the OnDemand offering.The printed books were shipped to me right away but it took a few days to receive them. So, in the meantime, I used the PDF files to complement the online classes and start learning.Almost a couple of weeks in, I can already feel how much this content is, especially since I’m planning to anticipate this exam so I can have more time to dedicate to preparing for the GCIH and, hopefully, build free time to visit my family at the end of August.In order to do that, I created a highly detailed study plan, with the rough amount of material I will go through each day. It might seem a bit too much, but doing this within two months and on top of a full-time job requires quite a bit of preparedness.Thankfully, I have the upcoming week off, so I plan to finish the first round of reading/listening to the material by the end of the week. My hope is to be able to finish a second round soon and do the first practice test by July 30th at the latest.Wish me luck!" }, { "title": "SANS Women's Immersion Academy - I'm in!", "url": "/posts/SANS-Womens-Immersion-Academy-Im-in/", "categories": "training", "tags": "SANS, women's immersion academy", "date": "2022-06-21 18:32:00 +0000", "snippet": "A year ago, as I was starting to refresh my Python and Bash skills, I would never have imagined that today I would be here. When I got intrigued by a “Practical Ethical Hacking” class on Udemy, I didn’t know where it would lead me.Soon after taking those small steps and completing the courses, I decided to explore cybersecurity as a career transition. But how do you move from a digital communications background and some off the records programming experience to a career that, at least on paper and for the most part, requires specific degrees, certifications, and an IT background? Especially, how do you do that while working in nonprofits and not being able to afford most of the fancy credentials that other people can claim?I started doing some research to understand what free or cheap resources I could get access to, in order to build that training and experience for myself. And the SANS Women’s Immersion Academy caught my eye, given their world-class education paths and knowing how valuable GIAC certifications are. I knew they would most likely open the application process in March, so I set a reminder on my calendar and got on with more training and learning.Application process, part one: online application and technical assessmentI started my application to the Academy a few days after SANS opened the portal, as I wanted to make sure I’d have enough time to go through all the steps and avoid rushing. There are a few forms that need to be filled and they include personal information as well as work and education history.Right after submitting that, I received an email with an invitation to complete an online technical assessment with 50 questions and two hours of available time, which needed to be completed within the following five days.Application process, part two: documents, references, and video submissionThe day after completing the technical assessment, I received another email requesting: Recommendation letters: I asked my former supervisor and two of my colleagues to submit a letter on my behalf. College transcripts: Since I went to college in Italy (my home country,) I submitted both the transcripts and their certified translation. Video submission: In three minutes, I explained why I was interested in pursuing cybersecurity and why I would have been successful if accepted into the Academy.Then, came the wait, a long wait of a little over two months. Even though I had almost lost hope, I heard rumors on social media saying that they had an outstanding number of applicants, reason why they were taking longer than expected to process all the applications.I was very excited when I heard back from the Academy towards the end of May: I was invited to a phone interview, which I scheduled for early June.Application process, part three: phone interviewDuring the first week of June, I was interviewed by the Director of the Academy and it was a really pleasant chat. He asked me about my background and how I had become passionate about cybersecurity. He also wanted to make sure I’d be aware of the commitment that the Academy requires of all the students.The decisionOn a Friday afternoon in early June, I received THAT email notification. The one that, in the subject line, says: “An Important Update To Your SANS Cyber Academy Application.”I froze for a moment and started breathing heavily. “Here we are, here we are,” I kept saying in my head.I took a deep breath, logged in, and there it was.Dear [my full name],Thank you for your interest in the SANS Women’s Immersion Academy, and congratulations!SANS is excited to extend you an invitation to enroll in the Academy. You are one of a select few to be afforded the opportunity to immerse yourself in intensive, high-end hands-on security courses from the SANS Institute.Woah. I couldn’t be happier.A few days after responding with a “HECK YEAH,” I received more information and an invite to a kickoff Zoom call, which is scheduled for later today.Off to this new adventure!" }, { "title": "Cyber Defense Challenge - Malware Analysis Report - Tier 1", "url": "/posts/cyber-defense-challenge-tier1-malware-report/", "categories": "projects", "tags": "malware analysis, reverse engineering, binary emulation, cyber defense challenge", "date": "2022-06-01 18:32:00 +0000", "snippet": "For the first tier of the Cyber Defense Challenge powered by Women in Cybersecurity and Target, I was given a spreadsheet containing malicious code and used tools such as Olevba, Speakeasy, Ghidra, and custom Python scripts to: Extract the malicious macro. De-obfuscate the code and extract shellcode. Emulate shellcode. Disassemble shellcode and extract IOCs and file names.As a result of the investigation, I produced this complete malware analysis report.DOWNLOAD THE PDF OF THE REPORT" } ]
